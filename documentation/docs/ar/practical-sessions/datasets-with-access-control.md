---
title: إعداد مجموعة بيانات موصى بها مع التحكم في الوصول
---

# إعداد مجموعة بيانات موصى بها مع التحكم في الوصول

!!! abstract "نتائج التعلم"
    بنهاية هذه الجلسة العملية، ستكون قادرًا على:

    - إنشاء مجموعة بيانات جديدة بسياسة بيانات 'موصى بها'
    - إضافة رمز وصول إلى مجموعة البيانات
    - التحقق من أن مجموعة البيانات لا يمكن الوصول إليها بدون رمز الوصول
    - إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات

## مقدمة

يمكن تكوين مجموعات البيانات التي لا تعتبر 'أساسية' في WMO اختياريًا مع سياسة التحكم في الوصول. يوفر wis2box آلية لإضافة رمز وصول إلى مجموعة البيانات والتي ستمنع المستخدمين من تنزيل البيانات ما لم يقدموا رمز الوصول في رؤوس HTTP.

## التحضير

تأكد من أن لديك وصول SSH إلى جهاز الطالب الافتراضي الخاص بك وأن نسخة wis2box الخاصة بك تعمل.

تأكد من أنك متصل بوسيط MQTT لنسخة wis2box الخاصة بك باستخدام MQTT Explorer. يمكنك استخدام بيانات الاعتماد العامة `everyone/everyone` للاتصال بالوسيط.

تأكد من أن لديك متصفح ويب مفتوح مع تطبيق wis2box-webapp الخاص بنسختك بالانتقال إلى `http://<your-host>/wis2box-webapp`.

## التمرين 1: إنشاء مجموعة بيانات جديدة بسياسة بيانات 'موصى بها'

انتقل إلى صفحة 'محرر المجموعة' في تطبيق wis2box-webapp وأنشئ مجموعة بيانات جديدة. استخدم نفس معرف المركز كما في الجلسات العملية السابقة واستخدم القالب='surface-weather-observations/synop'.

انقر على 'موافق' للمتابعة.

في محرر المجموعة، اضبط سياسة البيانات على 'موصى بها' (لاحظ أن تغيير سياسة البيانات سيحدث تحديثًا في 'التسلسل الهرمي للموضوع').
استبدل المعرف 'المحلي' المولد تلقائيًا بالاسم الوصفي لمجموعة البيانات، على سبيل المثال 'بيانات-موصى-بها-مع-التحكم-في-الوصول':

<img alt="create-dataset-recommended" src="../../assets/img/create-dataset-recommended.png" width="800">

استمر في ملء الحقول المطلوبة للخصائص المكانية ومعلومات الاتصال، و'تحقق من النموذج' للبحث عن أي أخطاء.

أخيرًا، أرسل مجموعة البيانات، باستخدام رمز المصادقة الذي تم إنشاؤه مسبقًا، وتحقق من أن مجموعة البيانات الجديدة قد تم إنشاؤها في تطبيق wis2box-webapp.

تحقق من MQTT-explorer لمعرفة أنك تتلقى رسالة إشعار WIS2 تعلن عن سجل بيانات الاكتشاف الجديد على الموضوع `origin/a/wis2/<your-centre-id>/metadata`.

## التمرين 2: إضافة رمز وصول إلى مجموعة البيانات

قم بتسجيل الدخول إلى حاوية إدارة wis2box،

```bash
cd ~/wis2box-1.0.0rc1
python3 wis2box-ctl.py login
```

من سطر الأوامر داخل الحاوية، يمكنك تأمين مجموعة البيانات باستخدام الأمر `wis2box auth add-token`، باستخدام العلم `--metadata-id` لتحديد معرف البيانات الوصفية لمجموعة البيانات ورمز الوصول كوسيط.

على سبيل المثال، لإضافة رمز الوصول `S3cr3tT0k3n` إلى مجموعة البيانات بمعرف البيانات الوصفية `urn:wmo:md:not-my-centre:core.surface-based-observations.synop`:

```bash
wis2box auth add-token --metadata-id urn:wmo:md:not-my-centre:reco.surface-based-observations.synop S3cr3tT0k3n
```

اخرج من حاوية إدارة wis2box:

```bash
exit
```

## التمرين 3: نشر بعض البيانات إلى مجموعة البيانات

انسخ الملف `exercise-materials/access-control-exercises/aws-example2.csv` إلى الدليل المحدد بواسطة `WIS2BOX_HOST_DATADIR` في ملف `wis2box.env` الخاص بك:

```bash
cp ~/exercise-materials/access-control-exercises/aws-example2.csv ~/wis2box-data
```

ثم استخدم WinSCP أو محرر سطر الأوامر لتحرير الملف `aws-example2.csv` وتحديث معرفات محطات WIGOS في البيانات المدخلة لتتطابق مع المحطات التي لديك في نسخة wis2box الخاصة بك.

بعد ذلك، انتقل إلى محرر المحطات في تطبيق wis2box-webapp. لكل محطة استخدمتها في `aws-example2.csv`، قم بتحديث حقل 'الموضوع' ليتطابق مع 'موضوع' مجموعة البيانات التي أنشأتها في التمرين السابق.

سيتم الآن ربط هذه المحطة بموضوعين، واحد لمجموعة البيانات 'الأساسية' وواحد لمجموعة البيانات 'الموصى بها':

<img alt="edit-stations-add-topics" src="../../assets/img/edit-stations-add-topics.png" width="600">

ستحتاج إلى استخدام رمزك لـ `collections/stations` لحفظ بيانات المحطة المحدثة.

بعد ذلك، قم بتسجيل الدخول إلى حاوية إدارة wis2box:

```bash
cd ~/wis2box-1.0.0rc1
python3 wis2box-ctl.py login
```

من سطر الأوامر في wis2box يمكننا إدخال ملف البيانات النموذجي `aws-example2.csv` في مجموعة بيانات محددة كما يلي:

```bash
wis2box data ingest -p /data/wis2box/aws-example2.csv --metadata-id urn:wmo:md:not-my-centre:reco.surface-based-observations.synop
```

تأكد من تقديم معرف البيانات الوصفية الصحيح لمجموعة البيانات الخاصة بك و**تحقق من أنك تتلقى إشعارات بيانات WIS2 في MQTT Explorer**، على الموضوع `origin/a/wis2/<your-centre-id>/data/recommended/surface-based-observations/synop`.

تحقق من الرابط القانوني في رسالة إشعار WIS2 وانسخ/الصق الرابط في المتصفح لمحاولة تنزيل البيانات.

يجب أن ترى خطأ 403 Forbidden.

## التمرين 4: إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات

من أجل إظهار أن رمز الوصول مطلوب للوصول إلى مجموعة البيانات، سنعيد إنتاج الخطأ الذي رأيته في المتصفح باستخدام وظيفة سطر الأوامر `wget`.

من سطر الأوامر في جهاز الطالب الافتراضي الخاص بك، استخدم الأمر `wget` مع الرابط القانوني الذي نسخته من رسالة إشعار WIS2.

```bash
wget <canonical-link>
```

يجب أن ترى أن طلب HTTP يعود بـ *401 Unauthorized* وأن البيانات لم يتم تنزيلها.

الآن أضف رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات.

```bash
wget --header="Authorization: Bearer S3cr3tT0k3n" <canonical-link>
```

الآن يجب أن يتم تنزيل البيانات بنجاح.

## الخاتمة

!!! success "تهانينا!"
    في هذه الجلسة العملية، تعلمت كيفية:

    - إنشاء مجموعة بيانات جديدة بسياسة بيانات 'موصى بها'
    - إضافة رمز وصول إلى مجموعة البيانات
    - التحقق من أن مجموعة البيانات لا يمكن الوصول إليها بدون رمز الوصول
    - إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات